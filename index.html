<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>PROTOCOLO METAMORFOSE</title>
    <style>
        /* --- CSS GLOBAL (Adaptado do Style Global) --- */
        :root {
            --bg-color: #050005;
            --tech-primary: #9d00ff;
            --tech-dim: #4b007d;
            --organic-alert: #ff003c;
            --ezequiel-glitch: #ffea00;
            --text-main: #e0ccff;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Consolas', 'Courier New', monospace;
            margin: 0; overflow: hidden; height: 100vh;
            display: flex; justify-content: center; align-items: center;
            text-transform: uppercase;
        }

        /* EFEITO CRT */
        body::after {
            content: " "; display: block; position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 999; background-size: 100% 2px, 3px 100%; pointer-events: none;
        }

        /* LAYOUT */
        #display-screen {
            width: 90%; height: 90%;
            border: 4px solid var(--tech-dim);
            padding: 40px;
            box-shadow: 0 0 40px rgba(157, 0, 255, 0.2);
            position: relative;
            background: radial-gradient(circle at center, #100010 0%, #000 90%);
            display: flex; flex-direction: column;
            z-index: 1;
        }

        h1 {
            color: var(--tech-primary);
            text-shadow: 0 0 10px var(--tech-primary);
            letter-spacing: 4px;
            border-bottom: 2px solid var(--tech-dim);
            text-align: center;
            margin-bottom: 30px; padding-bottom: 20px;
            font-size: 3.5rem;
        }

        .status-container {
            display: flex; flex-direction: column; gap: 15px;
            overflow-y: auto; flex: 1; padding-right: 10px;
        }

        .subject-row {
            font-size: 1.5rem; padding: 15px;
            border: 1px solid var(--tech-dim);
            display: flex; justify-content: space-between;
            background: rgba(10, 0, 20, 0.4);
            transition: all 0.3s;
            align-items: center;
        }

        .status { font-weight: bold; letter-spacing: 2px; }

        /* --- ESTADOS --- */
        .status.waiting { color: #555; animation: pulse-gray 2s infinite; }
        .row-waiting { border-color: #222; opacity: 0.6; }

        .status.alive { color: #00ff41; text-shadow: 0 0 10px #00ff41; }
        .row-alive { border-color: var(--tech-primary); box-shadow: inset 0 0 15px rgba(157, 0, 255, 0.1); }

        .status.dead { color: var(--organic-alert); text-shadow: 0 0 10px var(--organic-alert); animation: blink 1s infinite; }
        .row-dead { border-color: var(--organic-alert); background: rgba(50, 0, 0, 0.2); }

        /* --- ESTADO EZEQUIEL (GLITCH TOTAL) --- */
        .status.hacked { 
            color: var(--ezequiel-glitch); 
            text-shadow: 3px 0 var(--organic-alert), -2px 0 var(--tech-primary);
            font-weight: 900; 
            letter-spacing: 3px;
        }
        .row-hacked { border-color: var(--ezequiel-glitch); background: rgba(255, 234, 0, 0.05); }

        /* GLITCH GLOBAL */
        body.glitch-mode h1 { color: var(--ezequiel-glitch) !important; border-color: var(--ezequiel-glitch) !important; animation: glitch-anim 0.2s infinite; }
        body.glitch-mode #display-screen { border-color: var(--ezequiel-glitch); box-shadow: 0 0 50px var(--ezequiel-glitch); }

        #footer-msg { margin-top: auto; text-align: center; color: var(--tech-dim); padding-top: 20px; font-size: 0.9rem; }

        /* ANIMAÇÕES */
        @keyframes pulse-gray { 0% { opacity: 0.4; } 50% { opacity: 0.8; } 100% { opacity: 0.4; } }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
        @keyframes glitch-anim { 0% { transform: translate(0); } 20% { transform: translate(-2px, 2px); } 40% { transform: translate(-2px, -2px); } 60% { transform: translate(2px, 2px); } 80% { transform: translate(2px, -2px); } 100% { transform: translate(0); } }

    </style>
</head>
<body>

    <div id="display-screen">
        <h1 id="main-title">PROTOCOLO METAMORFOSE</h1>
        <div class="status-container" id="subjects-list">
            </div>
        <div id="footer-msg">
            > SISTEMA EM AGUARDO...
        </div>
    </div>

    <script src="js/system_core.js"></script>
    <script>
        channel.addEventListener('message', (e) => {
            if (e.data.type === 'SYNC_STATE') {
                render();
            }
        });

        function render() {
            const list = document.getElementById('subjects-list');
            list.innerHTML = '';

            // Verifica Glitch Global
            const isGlobalGlitch = globalState.ezequiel_keys[0] && globalState.ezequiel_keys[1] && globalState.ezequiel_keys[2];

            if(isGlobalGlitch) {
                document.body.classList.add('glitch-mode');
                document.getElementById('main-title').innerText = "FATAL ERROR";
            } else {
                document.body.classList.remove('glitch-mode');
                document.getElementById('main-title').innerText = "PROTOCOLO METAMORFOSE";
            }

            globalState.players.forEach(p => {
                let rowClass = "";
                let statusClass = "status ";
                let msg = "";
                let isEzequiel = false;

                if (isGlobalGlitch) {
                    statusClass += "hacked ezequiel-text"; // Usa amarelo glitch
                    rowClass = "row-hacked";
                    msg = "EZEQUIEL"; // Texto base para o script mudar
                } 
                else if (p.status === 'hacked') {
                    // HACKEADO (Amarelo Ezequiel com Glitch de Texto)
                    statusClass += "hacked ezequiel-text"; // Adiciona classe alvo para o JS
                    rowClass = "row-hacked";
                    msg = "EZEQUIEL"; 
                }
                else if (p.status === 'dead') {
                    statusClass += "dead";
                    rowClass = "row-dead";
                    msg = "!! SINAL CESSADO !!";
                } 
                else if (p.status === 'alive') {
                    statusClass += "alive";
                    rowClass = "row-alive";
                    msg = ">> CONECTADO";
                }
                else {
                    statusClass += "waiting";
                    rowClass = "row-waiting";
                    msg = "[ ... AGUARDANDO ... ]";
                }

                list.innerHTML += `
                    <div class="subject-row ${rowClass}">
                        <span style="color:var(--text-main); font-weight:bold;">${p.name.toUpperCase()}</span>
                        <span class="${statusClass}">${msg}</span>
                    </div>
                `;
            });
        }

        // --- SCRIPT DE GLITCH DE TEXTO (EZEQUIEL) ---
        // Roda independente do render para animar o texto
        setInterval(() => {
            const targets = document.querySelectorAll('.ezequiel-text');
            const fonts = ['Courier New', 'Impact', 'Arial Black', 'Times New Roman', 'Consolas', 'Tahoma'];
            const baseText = "EZEQUIEL";

            targets.forEach(el => {
                // 1. Troca Fonte Aleatoriamente
                el.style.fontFamily = fonts[Math.floor(Math.random() * fonts.length)];

                // 2. Reconstrói o texto com modificações (Maiúscula/Minúscula/Números)
                let newText = "";
                for (let char of baseText) {
                    // Random Case
                    if (Math.random() > 0.5) char = char.toLowerCase();
                    
                    // Random Leet (Números)
                    if (Math.random() > 0.6) {
                        if (char.toUpperCase() === 'E') char = '3';
                        if (char.toUpperCase() === 'Z') char = '2';
                        if (char.toUpperCase() === 'Q') char = '0';
                        if (char.toUpperCase() === 'U') char = 'v';
                        if (char.toUpperCase() === 'I') char = '1';
                        if (char.toUpperCase() === 'L') char = '7';
                    }
                    newText += char;
                }
                
                el.innerText = newText;

                // 3. Flash de cor (Branco) ocasional
                if (Math.random() > 0.85) el.style.color = "#fff";
                else el.style.color = "var(--ezequiel-glitch)"; // Amarelo
            });

        }, 100); // 100ms = 10 frames por segundo (bem rápido)

        setTimeout(render, 100);
    </script>
</body>
</html>